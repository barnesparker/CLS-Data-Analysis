---
title: "Data Cleaning"
author: "Parker Barnes"
date: "3/6/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_knit$set(root.dir = "C:\\Users\\pbarnes6\\Box\\Work (Project Assistant)\\data analysis\\test")
library(tidyr)
library(dplyr)
library(stringr)
library(xlsx)
library(Rwinsteps)
```

```{r}
# options for remove_dups:
  # "all": leaves only unique rows. all duplicates including their originals are removed
  # "some": removes duplicates but keeps originals. Let's R decide which ones to keep
  # "none": keeps everything
get_data <- function(lang, skill, remove_dups = "some") {
# list all filenames with specified language and skill
  data <- list.files(pattern = paste0(lang, ".", skill), ignore.case = T, full.names = T) %>% 
  # rename files so they have the '.csv' extension
  sapply(function (n) {file.rename(n, paste0(n, ".csv"))}) %>% 
  names() %>% 
  str_c(".csv") %>% 
  # read all the files and bind them into a single file
  sapply(read.csv, simplify = F, stringsAsFactors = F) %>% 
  bind_rows()

  if(remove_dups %in% c("some", "s")) 
    data <- distinct(data, data[1]) 
  else if(remove_dups %in% c("all", "a")) {
    dups <- data[duplicated(data[1]),]
    data <- data[!which(data$Student_Name %in% dups)] 
  }
data
}

lang <- "Spanish"
skill <- "R"
data <- get_data(lang, skill, "s")
```

```{r}
# Simulate data, with missings
set.seed(82911)
b <- seq(-3, 3, length = 15)
theta <- rnorm(100, 1)
rmat <- ifelse(rirf(b, theta)$p > runif(1500), 1, 0)
rmat[sample(1500, 30)] <- NA
rmat <- data.frame(rmat)
# Item and person labels
colnames(rmat) <- paste("i", 1:15, sep = "")
rmat$name <- paste("p", 1:100, sep = "")
rmat <- rmat[, c(16, 1:15)]
# Create command file
tempdat <- tempfile()
cmd <- wcmd(title = "R2Winsteps Example", data = tempdat,
item1 = 1, ni = 15, name1 = 16, namelen = 5,
labels = paste("i", 1:15, sep = ""), hlines = "Y")
# Write to temp file and read back in
write.wdat(rmat, cmd, na = "N")


winsteps(cmd, windir = "C:\\Winsteps\\winsteps.exe")
# as.winsteps(cmd, ifile, pfile, daterun, comptime)
```


```{r}
compress <- function(x) c(na.omit(x), NA)[1]

Lines <- "ID Value1 Value2 Value3 Value4 Value5 Value6
1 A B C x x NA
1 A B C NA NA x
2 A B C NA x 2
2 A B C x NA 1"
DF <- read.table(text = Lines, header = TRUE, as.is = TRUE)

aggregate(DF[5:7], DF[1:4], compress)

```




